var cursorx,cursory,serverurl="ws://64.227.108.75:2828/",maincursormove=!0,clientLevel=-1,prevLevels=[],grid=5,movement=!1,serverx=0,servery=0;let ws=new WebSocket("ws://localhost:8080");ws.onmessage=function(e){var t=JSON.parse(e.data);void 0!==t.botsCount&&(document.getElementById("botCounter").innerHTML=t.botsCount)};var arrows={arrowLeft:[[0,-6,-2,-4],[2,-4,0,-6],[0,0,0,-6]],arrowUp:[[-1,0,-6,0],[0,0,-1,0],[-4,-2,-6,0],[-4,2,-6,0]],arrowRight:[[0,6,0,0],[-2,4,0,6],[2,4,0,6]],arrowDown:[[0,0,6,0],[4,-2,6,0],[4,2,6,0]]},imgData={cursor:[[10,0,0,0],[7,3,10,0],[7,7,7,3],[0,0,7,7]],cursorInRect:[[10,0,0,0],[7,3,10,0],[7,3,7,3],[7,7,7,3],[0,0,7,7],[12,-9,-4,-9],[12,-9,12,-9],[12,13,12,-9],[-3,13,12,13],[-4,13,-3,13],[-4,-9,-4,13],[1,7,-4,13],[12,13,1,7],[1,-4,-4,-9],[12,-9,1,-4]],cuteSmile:[[1,2,1,1],[2,2,1,2],[2,1,2,2],[1,1,2,1],[2,2,1,1],[1,2,2,1],[2,4,1,4],[2,5,2,4],[1,5,2,5],[1,4,1,5],[2,5,1,4],[1,5,2,4],[3,5,3,1],[4,5,3,5],[5,4,4,5],[5,3,5,4],[5,2,5,3],[4,1,5,2],[3,1,4,1]],dickButt:[[105,27,81,12],[81,12,45,5],[45,5,39,2],[39,2,29,8],[29,8,30,15],[30,15,35,19],[35,19,43,15],[43,15,45,5],[45,5,40,12],[40,12,34,13],[34,13,29,8],[22,38,33,32],[33,32,39,35],[39,35,37,47],[37,47,29,50],[29,50,24,46],[24,46,22,38],[22,38,28,43],[28,43,35,40],[35,40,39,35],[33,24,46,17],[46,17,49,20],[49,20,46,28],[41,52,60,8],[29,8,14,14],[14,14,6,23],[6,23,3,37],[3,37,5,47],[5,47,15,55],[15,55,48,63],[48,63,71,74],[71,74,63,81],[63,81,58,91],[58,91,59,99],[59,99,29,103],[29,103,27,109],[27,109,31,115],[31,115,60,114],[60,114,55,123],[55,123,57,127],[57,127,63,127],[63,127,65,120],[63,127,66,132],[66,132,73,132],[73,132,78,121],[78,121,69,116],[69,116,66,105],[66,105,67,96],[67,96,59,99],[67,96,70,89],[70,89,68,83],[70,89,77,84],[78,121,86,122],[86,122,103,114],[103,114,110,104],[110,104,111,97],[111,97,138,103],[138,103,132,85],[132,85,125,81],[125,81,127,94],[127,94,113,91],[113,91,120,79],[120,79,122,64],[122,64,152,62],[152,62,144,46],[144,46,138,44],[138,44,141,57],[141,57,122,58],[122,58,119,43],[119,43,105,27],[61,50,91,59],[91,59,96,57],[96,57,102,58],[102,58,102,62],[102,62,95,61],[95,61,102,65],[102,65,101,68],[101,68,94,66],[94,66,94,75],[94,75,91,75],[91,75,88,64],[88,64,60,56],[73,82,74,80],[79,97,82,95],[92,96,94,94],[96,100,98,98],[100,105,101,104],[48,111,49,109],[52,111,53,109]]},visit=[];function mkHTML(e,t={}){var a=document.createElement(e);for(var r in t)a[r]=t[r];return a}dos=function(e,t,a,r){var n=400/r,o=300/r,i=[];visit=[];for(var l=0;l<o;l++){i[l]=[],visit[l]=[];for(var s=0;s<n;s++)i[l][s]=0,visit[l][s]=0}a.forEach(function(e){if(1===e.type)for(var t=0;t<e.height;t+=r)for(var a=0;a<e.width;a+=r)i[(e.y+t)/r][(e.x+a)/r]=3});for(var c=[[e,t]],h=[];c.length;)c.forEach(function(e){var t=e[0],a=e[1];if(3!=i[a][t]){i[a][t]=3;for(var r=t+1;r<n&&!(1&i[a][r]);r++)i[a][r]|=1,visit[a][r]||(visit[a][r]=[t,a],h.push([r,a]));for(r=t-1;r>=0&&!(1&i[a][r]);r--)i[a][r]|=1,visit[a][r]||(visit[a][r]=[t,a],h.push([r,a]));for(var l=a+1;l<o&&!(2&i[l][t]);l++)i[l][t]|=2,visit[l][t]||(visit[l][t]=[t,a],h.push([t,l]));for(l=a-1;l>=0&&!(2&i[l][t]);l--)i[l][t]|=2,visit[l][t]||(visit[l][t]=[t,a],h.push([t,l]))}}),c=h,h=[]},path=function(e,t,a,r,n,o){var i=a,l=r;e/=o,t/=o,a/=o,r/=o,t|=0,r|=0;var s=[];if((e|=0)!=(a|=0)||t!=r){dos(e,t,n,o);for(var c=[a,r];visit[c[1]][c[0]];)s.push(c),c=visit[c[1]][c[0]];s.reverse()}for(var h=0;h<s.length;++h)s[h][0]*=o,s[h][0]+=o/2,s[h][1]*=o,s[h][1]+=o/2;return s.push([i,l]),s};var drawing=!1,drawingScale=1,customImage=[],cheatDiv=document.createElement("div");function mkText(e,t=!1){return cheatDiv.appendChild(mkHTML(t?"div":"span",{innerHTML:e}))}cheatDiv.style.border="3px solid currentColor";var moveInterval,keybinds=(()=>{for(var e={digit1:{action:function(){ws.send(JSON.stringify({eval:"clickingAllButtons"}))},description:"Starts clicking all buttons",keyName:"Digit 1"},digit2:{action:function(){drawArray(customImage)},description:"Draws custom image",keyName:"Digit 2"},digit9:{action:function(){ws.send(JSON.stringify({eval:"deploy",x:p,y:s}))},description:"Deploys a bot to your mouse position",keyName:"Digit 9"},digit0:{action:function(){ws.send(JSON.stringify({eval:"undeploy"}))},description:"Undeploys a bot (click somewhere to get the bot back to you)",keyName:"Digit 0"},arrowleft:{action:function(){drawArray(arrows.arrowLeft)},description:"Draws the left arrow",keyName:"Left arrow"},arrowup:{action:function(){drawArray(arrows.arrowUp)},description:"Draws the top arrow",keyName:"Top arrow"},arrowright:{action:function(){drawArray(arrows.arrowRight)},description:"Draws the right arrow",keyName:"Right arrow"},arrowdown:{action:function(){drawArray(arrows.arrowDown)},description:"Draws the bottom arrow",keyName:"Bottom arrow"}},t=Object.keys(imgData),a=0;a<t.length;a++){let r=t[a],n=(a<=8?"Digit":"Null")+" "+(a+3);e[(a<=8?"digit":"null")+(a+3)]={action:function(){drawArray(imgData[r])},description:"Draws "+r,keyName:n}}return e})();function addKeybinds(){for(var e in keybinds){var t=keybinds[e];mkText(`${t.keyName} or click `),cheatDiv.appendChild(mkHTML("button",{onclick:t.action,innerHTML:"button"})),mkText(`: ${t.description}`),cheatDiv.appendChild(mkHTML("br"))}}mkText("Bot count: "),cheatDiv.appendChild(mkHTML("span",{id:"botCounter",innerHTML:0})),cheatDiv.appendChild(mkHTML("br")),mkText("Bot count to connect: "),cheatDiv.appendChild(mkHTML("input",{id:"botsCountToConnect",value:20,min:1,type:"number",placeholder:"Count"})),mkText(" bots per proxy: "),cheatDiv.appendChild(mkHTML("input",{id:"botsPerProxy",value:1,min:1,max:3,type:"number",placeholder:"Count"})),mkText(" connecting timeout: "),cheatDiv.appendChild(mkHTML("input",{id:"botsTimeout",value:10,min:10,type:"number",placeholder:"Timeout"})),cheatDiv.appendChild(mkHTML("button",{innerHTML:"connect",onclick:function(){if("connect"===this.innerHTML){this.innerHTML="disconnect";var e=parseInt(document.getElementById("botsCountToConnect").value),t=parseInt(document.getElementById("botsPerProxy").value),a=parseInt(document.getElementById("botsTimeout").value);ws.send(JSON.stringify({eval:"connect",ws:serverurl,origin:window.origin,count:e,botsPerProxy:t,timeout:a}))}else this.innerHTML="connect",ws.send(JSON.stringify({eval:"stop"}))}})),cheatDiv.appendChild(mkHTML("br")),mkText("Text to draw (keybind: enter?): "),cheatDiv.appendChild(mkHTML("input",{id:"message",placeholder:"Type and press enter"})),mkText(" Font size: "),cheatDiv.appendChild(mkHTML("input",{id:"fontOfMessage",value:2,type:"number",placeholder:"Font size"})),cheatDiv.appendChild(mkHTML("br")),mkText("Drawing scale: "),cheatDiv.appendChild(mkHTML("input",{id:"drawingScale",type:"number",value:drawingScale,placeholder:"Scale",onchange:function(){drawingScale=parseFloat(this.value)}})),cheatDiv.appendChild(mkHTML("br")),cheatDiv.appendChild(mkHTML("div",{id:"parsingError",style:"color: #ff0000"})),mkText("Paste here custom image: "),cheatDiv.appendChild(mkHTML("input",{value:JSON.stringify(imgData.cuteSmile),placeholder:JSON.stringify(imgData.cuteSmile),onchange:async function(){try{customImage=JSON.parse(this.value)}catch(e){document.getElementById("parsingError").innerHTML="parsing error",await sleep(3e3),document.getElementById("parsingError").innerHTML=""}}})),cheatDiv.appendChild(mkHTML("br")),cheatDiv.appendChild(mkHTML("br")),cheatDiv.appendChild(mkHTML("span",{style:"font-size: 25px",innerHTML:"Keybinds: "})),cheatDiv.appendChild(mkHTML("br")),addKeybinds();try{document.getElementsByTagName("a")[0].remove(),document.getElementsByTagName("div")[4].remove()}catch(e){}document.getElementsByTagName("div")["http://cursors.io"===window.origin?3:2].appendChild(cheatDiv);var alphabet={32:[],33:[[0,1,1.5,1],[2,1,2.5,1]],34:[[0,.5,1,.5],[0,1.25,1,1.25]],35:[[.5,-.25,.5,2.3],[1.5,-.25,1.5,2.3],[-.25,.5,2.3,.5],[-.25,1.5,2.3,1.5]],36:[[0,0,0,2],[1,0,1,2],[2,0,2,2],[0,0,1,0],[1,2,2,2],[-.5,1,0,1],[2,1,2.5,1]],37:[[1,0,0,0],[0,0,0,1],[0,1,2,1],[2,1,2,2],[2,2,1,2],[1,2,1,0],[2,0,0,2]],38:[[.5,1,0,1],[0,1,0,0],[0,0,2,0],[2,0,2,.5],[2,.5,1,1.5],[1,0,1,.5],[1,.5,2,1.5]],39:[[0,.5,1,.5]],40:[[0,2,.5,1],[.5,1,1.5,1],[1.5,1,2,2]],41:[[0,0,.5,1],[.5,1,1.5,1],[1.5,1,2,0]],42:[[.5,0,1.5,2],[1.5,0,.5,2],[0,1,2,1]],43:[[0,1,2,1],[1,0,1,2]],44:[[2,0,3,0]],45:[[.6,.3,.6,1.7]],46:[[1.5,0,2,0]],47:[[2,.4,0,1.6]],48:[[2,0,0,0],[0,0,0,2],[0,2,2,2],[2,2,2,0],[2,0,0,2]],49:[[0,1,2,1],[1,0,0,1],[2,0,2,2]],50:[[0,0,0,2],[0,2,1,2],[1,2,1,0],[1,0,2,0],[2,0,2,2]],51:[[0,0,0,2],[0,2,2,2],[2,2,2,0],[1,0,1,2]],52:[[0,0,1,0],[1,0,1,2],[0,2,2,2]],53:[[0,2,0,0],[0,0,1,0],[1,0,1,2],[1,2,2,2],[2,2,2,0]],54:[[0,2,0,0],[0,0,2,0],[2,0,2,2],[2,2,1,2],[1,2,1,0]],55:[[0,0,0,2],[0,2,2,0]],56:[[0,0,0,2],[0,2,2,2],[2,2,2,0],[2,0,0,0],[1,0,1,2]],57:[[0,0,1,0],[1,0,1,2],[0,2,2,2],[0,0,0,2],[2,0,2,2]],58:[[0,1,.5,1],[1.5,1,2,1]],59:[[0,1,.5,1],[2,1,3,1]],60:[[0,2,1,0],[1,0,2,2]],61:[[.5,0,.5,2],[1.5,0,1.5,2]],62:[[0,0,1,2],[1,2,2,0]],63:[[1,0,0,0],[0,0,0,2],[0,2,1,2],[1,2,1,1],[1,1,1.5,1],[2,1,2.5,1]],64:[[2.5,2,2.5,0],[2.5,0,-.5,0],[-.5,0,-.5,2],[-.5,2,1.5,2],[1.5,2,1.5,1],[1.5,1,.5,1],[.5,1,.5,2]],91:[[0,1.5,0,.5],[0,.5,2,.5],[2,.5,2,1.5]],92:[[0,.4,2,1.6]],93:[[0,.5,0,1.5],[0,1.5,2,1.5],[2,1.5,2,.5]],94:[[1.5,0,0,1],[0,1,1.5,2]],95:[[2,0,2,2]],96:[[0,.5,1,.5]],97:[[2,0,0,0],[0,2,0,0],[0,2,2,2],[1,0,1,2]],98:[[2,0,0,0],[0,0,0,1],[1,0,1,1],[2,0,2,1],[0,1,.5,2],[.5,2,1,1],[1,1,1.5,2],[1.5,2,2,1]],99:[[2,2,2,0],[2,0,0,0],[0,0,0,2]],100:[[2,0,0,0],[0,0,0,1],[0,1,1,2],[1,2,2,1],[2,1,2,0]],101:[[2,2,2,0],[2,0,0,0],[0,0,0,2],[1,0,1,2]],102:[[2,0,0,0],[0,0,0,2],[1,0,1,2]],103:[[1,1,1,2],[1,2,2,2],[2,2,2,0],[2,0,0,0],[0,0,0,2]],104:[[0,0,2,0],[0,2,2,2],[1,0,1,2]],105:[[0,0,0,2],[0,1,2,1],[2,0,2,2]],106:[[1.5,0,2,0],[2,0,2,1.5],[0,1.5,2,1.5],[0,.85,0,2.25]],107:[[0,0,2,0],[1,0,0,2],[1,0,2,2]],108:[[0,0,2,0],[2,0,2,2]],109:[[0,0,2,0],[0,0,2,1],[2,1,0,2],[0,2,2,2]],110:[[0,0,2,0],[0,0,2,2],[0,2,2,2]],111:[[2,0,0,0],[0,0,0,2],[0,2,2,2],[2,2,2,0]],112:[[2,0,0,0],[0,0,0,2],[0,2,1,2],[1,2,1,0]],113:[[2,0,0,0],[0,0,0,2],[0,2,2,2],[2,2,2,0],[1,1,2,2]],114:[[2,0,0,0],[0,0,0,2],[0,2,1,2],[1,2,1,0],[1,1,2,2]],115:[[0,0,0,2],[1,0,1,2],[2,0,2,2],[0,0,1,0],[1,2,2,2]],116:[[0,0,0,2],[0,1,2,1]],117:[[0,0,2,0],[0,2,2,2],[2,0,2,2]],118:[[0,0,2,1],[0,2,2,1]],119:[[0,0,2,0],[0,2,2,2],[2,0,1,1],[2,2,1,1]],120:[[0,0,2,2],[2,0,0,2]],121:[[0,0,1,1],[0,2,1,1],[2,1,1,1]],122:[[0,0,0,2],[0,2,2,0],[2,0,2,2]],123:[[0,1.5,0,.5],[0,.5,.5,.5],[.5,.5,1,0],[1,0,1.5,.5],[1.5,.5,2,.5],[2,.5,2,1.5]],124:[[0,1,2,1]],125:[[0,.5,0,1.5],[0,1.5,.5,1.5],[.5,1.5,1,2],[1,2,1.5,1.5],[1.5,1.5,2,1.5],[2,1.5,2,.5]],126:[[.5,0,0,.75],[0,.75,.5,1.5],[.5,1.5,0,2.25]]};function drawOnPlayer(e,t,a,r){var n=new ArrayBuffer(9);new DataView(n);drawOnCoords(e=serverx+e,t=serverx+t,a=serverx+a,r=serverx+r)}function drawOnCoords(e,t,a,r){var n=new ArrayBuffer(9),o=new DataView(n);o.setUint8(0,3),o.setUint16(1,e,!0),o.setUint16(3,t,!0),o.setUint16(5,a,!0),o.setUint16(7,r,!0),ws.send(JSON.stringify({eval:"draw",x1:e,y1:t,x2:a,y2:r})),serverx=a,servery=r,q.send(n)}function sleep(e){return new Promise(t=>setTimeout(t,e))}async function drawWord(e,t=serverx,a=servery,r=2,n=3,o=250){return null!=(e=e.trim())&&0!==e.length&&1!=drawing&&new Promise(async function(i){await ua(t,a);for(var l=0;l<e.length;l++){var s=1;e[l]==e[l].toLowerCase()&&(s=.75);let i=alphabet[e.toLowerCase().charCodeAt(l)]||alphabet[63]||[];for(let e of i){drawOnCoords(t+(e[1]*s+n*l)*r,a+e[0]*s*r,t+(e[3]*s+n*l)*r,a+e[2]*s*r),await sleep(Math.floor(o/i.length))}}drawing=!1,await ua(t,a),i(!0)})}async function drawArray(e,t=serverx,a=servery,r=70,n=drawingScale){for(var o=0;o<e.length;o++){drawOnCoords(t+e[o][1]*n,a+e[o][0]*n,t+e[o][3]*n,a+e[o][2]*n),await sleep(r)}}function ra(e){return e<<1}function S(){return document.pointerLockElement===x||document.mozPointerLockElement===x||document.webkitPointerLockElement===x}function aa(){throw a.fillStyle="#000000",a.font="35px NovaSquare",a.fillText("Please do not embed our website, thank you.",400-a.measureText("Please do not embed our website, thank you.").width/2,300),a.font="16px NovaSquare",a.fillText("Play the game on http://cursors.io/",400-a.measureText("Play the game on http://cursors.io/").width/2,330),top.location="http://cursors.io","Please do not embed our website, thank you."}function U(e,t){F=e,G=t,k=p=e,l=s=t,A=p<<1,B=s<<1}function ta(e){if(y)return H=!1,T(e),!1;if(S()?V||(V=!0,U(k,l)):(V=!1,y||I.checked||x.requestPointerLock&&x.requestPointerLock()),H)H=!1,J();else if(T(e),(e.ctrlKey||e.shiftKey||e.altKey)&&!C.checked)W=!0,N=k,O=l;else if(100<t-ba){ba=t,D.push([p<<1,s<<1,t]),ua(p,s);var a=[p,s];K.push(a),setTimeout(function(){K.remove(a)},1e3)}return!1}function va(e){W=!1}function socketConnect(){(q=new WebSocket(serverurl)).binaryType="arraybuffer",q.onopen=onSocketConnect,q.onmessage=socketOnMessage,q.onclose=onSocketClose,q.onerror=onSocketError}function Ba(){window.localStorage&&I&&(window.localStorage.setItem("noCursorLock",I.checked?"1":"0"),window.localStorage.setItem("noDrawings",C.checked?"1":"0"))}function T(e){if(S()){var a=e.webkitMovementX||e.mozMovementX||e.movementX||0;e=e.webkitMovementY||e.mozMovementY||e.movementY||0,300>Math.abs(a)+Math.abs(e)&&X(A+a,B+e)}else e.offsetX?X(e.offsetX,e.offsetY):e.layerX&&X(e.layerX,e.layerY);if(y)k=p,l=s;else if(Y(),!S()||p==k&&s==l||(e=a=0,p>k&&(a=1),s>l&&(e=1),A=((p=k)<<1)+a,B=((s=l)<<1)+e),W&&(N!=k||O!=l)&&50<t-da){a=N,e=O;var r=k,n=l;if(!y&&null!=q&&q.readyState==WebSocket.OPEN){var o=new ArrayBuffer(9),i=new DataView(o);i.setUint8(0,3),i.setUint16(1,a,!0),i.setUint16(3,e,!0),i.setUint16(5,r,!0),i.setUint16(7,n,!0),ws.send(JSON.stringify({eval:"draw",x1:a,y1:e,x2:r,y2:n})),q.send(o),serverx=r,servery=n}N=k,O=l,da=t}}function X(e,t){p=(A=e)>>1,s=(B=t)>>1}function Y(){var e=k,t=l;if(P(k,l)){var a;e:{a=k;var r=l,n=[],o=new Uint8Array(12e4);n.push([a,r]),o[a+400*r]=1;do{var i=(c=n.shift())[0],c=c[1];if(!(0>i||0>c||400<=i||300<=c)){if(!P(i,c)){a={x:i,y:c};break e}o[i-1+400*c]||(n.push([i-1,c]),o[i-1+400*c]=1),o[i+1+400*c]||(n.push([i+1,c]),o[i+1+400*c]=1),o[i+400*(c-1)]||(n.push([i,c-1]),o[i+400*(c-1)]=1),o[i+400*(c+1)]||(n.push([i,c+1]),o[i+400*(c+1)]=1)}}while(0<n.length);a={x:a,y:r}}k=a.x,l=a.y}k==p&&l==s||(a=ea(k,l,p,s),k=a.x,l=a.y,cursorx=p,cursory=s),fa(F,G,e,t)&&!fa(F,G,k,l)&&(J(e,t),J(k,l));e:{for(e=0;e<m.length;e++)if(2==(t=m[e]).type&&!(k<t.x||l<t.y||k>=t.x+t.width||l>=t.y+t.height)){e=!0;break e}e=!1}e&&J()}function Z(){Q.set(Ca),m=[],D=[],L=[]}function onSocketConnect(){Z(),console.log("Connected!")}function onSocketClose(e){Z(),console.log("Socket closed: "+e.reason),socketConnect()}function onSocketError(e){console.log("Socket error: "+e)}function Da(e,t){for(var a="",r=0,n=0;0!=(n=e.getUint8(t));++t)r<<=8,r|=n,128&n||(a+=String.fromCharCode(r),r=0);return 0!=r&&(a+=String.fromCharCode(r)),[a,t+1]}function Ea(e,a){return setTimeout(function(){var r=e.getUint16(a,!0),n=0;e:for(;n<r;n++){for(var o=e.getUint16(a+2+4*n,!0),i=e.getUint16(a+4+4*n,!0),l=0;l<K.length;l++){var s=K[l];if(s[0]==o&&s[1]==i){K.splice(l,1);continue e}}D.push([o<<1,i<<1,t])}},100),a+2+4*e.getUint16(a,!0)}function Fa(e,a){return!C.checked&&setTimeout(function(){for(var r=e.getUint16(a,!0),n=0;n<r;n++){var o=e.getUint16(a+2+8*n,!0),i=e.getUint16(a+4+8*n,!0),l=e.getUint16(a+6+8*n,!0),s=e.getUint16(a+8+8*n,!0);L.push([o<<1,i<<1,l<<1,s<<1,t])}},50),a+2+8*e.getUint16(a,!0)}function socketOnMessage(e){e=e.data;var a=new DataView(e);switch(a.getUint8(0)){case 0:ga=a.getUint32(1,!0),console.log(ga);break;case 1:var r;ha=r=a.getUint16(1,!0),ia=100<=r;var n,o=[];for(n in v)v.hasOwnProperty(n)&&o.push(n);for(var i=0;i<r;i++){n=a.getUint32(3+8*i,!0);var l=a.getUint16(7+8*i,!0),s=a.getUint16(9+8*i,!0);if(n!=ga)if(null!=v[n]){for(var c=0;c<o.length;c++)if(o[c]==n){o.splice(c,1);break}(n=v[n]).oldX=n.getX(),n.oldY=n.getY(),n.newX=l,n.newY=s,n.time=t}else v[n]=new ja(l,s)}for(i=0;i<o.length;i++)delete v[o[i]];for(r=Ea(a,3+8*r),n=a.getUint16(r,!0),r+=2,o=0;o<n;o++){e:for(l=a.getUint32(r,!0),i=0;i<m.length;i++)if(m[i].id==l){if(1==(h=m[i]).type){l=0|h.x,s=0|h.y,c=0|h.width;for(var h=0|h.height,d=s;d<s+h;++d)for(var f=l;f<l+c;++f)--Q[f+400*d]}m.splice(i,1);break e}r+=4}for(n=a.getUint16(r,!0),r+=2,o=0;o<n;o++){e:{for(i=a.getUint32(r,!0),l=0;l<m.length;l++)if(m[l].id==i){i=m[l];break e}i={id:i},m.push(i)}r=ka(a,r+=4,i)}if(r=Fa(a,r),e.byteLength<r+4)break;$=a.getUint32(r,!0);break;case 4:for(-1===clientLevel&&clientLevel++,Z(),serverx=a.getUint16(1,!0),servery=a.getUint16(3,!0),U(a.getUint16(1,!0),a.getUint16(3,!0)),n=a.getUint16(5,!0),r=7,o=0;o<n;o++)(i={}).id=a.getUint32(r,!0),r=ka(a,r+=4,i),m.push(i);e.byteLength>=r+4?u=Math.max(u,a.getUint32(r,!0)):e.byteLength>=r+2&&(u=Math.max(u,a.getUint16(r,!0))),Y(),grid=100;for(var g=0;g<m.length;++g){if(grid<=1){grid=1;break}1===m[g].type&&((m[g].x/grid|0)==m[g].x/grid&&(m[g].y/grid|0)==m[g].y/grid&&(m[g].width/grid|0)==m[g].width/grid&&(m[g].height/grid|0)==m[g].height/grid||(--grid,g=-1))}var p=[];for(g=0;g<m.length;++g){var y=m[g];0===y.type?p.push({x:y.x,y:y.y,size:y.size,content:y.content}):1===y.type?"#000000"===y.color&&p.push({x:y.x,y:y.y,w:y.width,h:y.height}):2===y.type?p.push({x:y.x,y:y.y,w:y.width,h:y.height,isBad:y.isBad}):p.push({x:y.x,y:y.y,w:y.width,h:y.height,color:y.color})}p=JSON.stringify(p),-1!=(g=prevLevels.indexOf(p))?clientLevel=g:(++clientLevel,prevLevels.push(p)),ws.send(JSON.stringify({eval:"levelUpdate",level:clientLevel}));break;case 5:serverx=a.getUint16(1,!0),servery=a.getUint16(3,!0),U(a.getUint16(1,!0),a.getUint16(3,!0)),9<=a.byteLength?u=Math.max(u,a.getUint32(5,!0)):7<=a.byteLength&&(u=Math.max(u,a.getUint16(5,!0))),Y()}}function J(e,t){}function ua(e,t,a=0){if(!y&&null!=q&&q.readyState==WebSocket.OPEN)return new Promise(async function(e){var t=path(serverx,servery,p,s,m,grid),r=new ArrayBuffer(9),n=new DataView(r);ws.send(JSON.stringify({eval:"move",x:p,y:s}));for(var o=0;o<t.length;o++){var i=t[o];n.setUint8(0,1),n.setUint16(1,i[0],!0),n.setUint16(3,i[1],!0),n.setUint32(5,-1,!0),q.send(r),serverx=i[0],servery=i[1],await sleep(a)}n.setUint8(0,2),q.send(r),e()})}function ka(e,a,r){function n(){r.x=e.getUint16(a,!0),a+=2,r.y=e.getUint16(a,!0),a+=2,r.width=e.getUint16(a,!0),a+=2,r.height=e.getUint16(a,!0),a+=2}function o(){for(var t=e.getUint32(a,!0).toString(16);6>t.length;)t="0"+t;a+=4,r.color="#"+t}var i=e.getUint8(a);switch(a+=1,r.type=i,i){case 255:break;case 0:r.x=e.getUint16(a,!0),a+=2,r.y=e.getUint16(a,!0),a+=2,r.size=e.getUint8(a),a+=1,r.isCentered=!!e.getUint8(a),i=Da(e,a+=1),r.text=i[0],a=i[1];break;case 1:n();var l=!r.color;o();i=0|r.x;var s=0|r.y,c=0|r.width,h=0|r.height;if(l)for(l=s;l<s+h;++l)for(var d=i;d<i+c;++d)++Q[d+400*l];break;case 2:n(),r.isBad=!!e.getUint8(a),a+=1;break;case 3:n(),r.count=e.getUint16(a,!0),a+=2,o();break;case 4:n(),r.count?r.count>e.getUint16(a,!0)&&(r.lastClickAt=t):r.lastClickAt=0,r.count=e.getUint16(a,!0),a+=2,o();break;default:throw Error("Unknown object type "+i)}return a}function la(){if(a.clearRect(0,0,800,600),a.save(),null!=q&&q.readyState!=WebSocket.OPEN||H){var e;if(null==q)e="Click to begin";else switch(q.readyState){case WebSocket.CONNECTING:e="Connecting";break;case WebSocket.CLOSING:case WebSocket.CLOSED:e="Lost connection to server";break;default:e="Click to begin"}a.font="60px NovaSquare",a.fillText(e,400-a.measureText(e).width/2,315),ma(),na(!1)}else{for(a.fillStyle="#000000",a.save(),a.globalAlpha=1,Ga(),e=0;e<m.length;e++){var r=m[e];if(0==r.type){a.font=r.size+"px NovaSquare";var n=r.x<<1,o=r.y<<1;r.isCentered&&(n-=a.measureText(r.text).width/2),a.fillStyle="#000000",a.fillText(r.text,n,o)}else if(1==r.type)a.fillStyle=r.color,a.fillRect(r.x<<1,r.y<<1,r.width<<1,r.height<<1),a.strokeStyle="#000000",a.globalAlpha=.2,a.lineWidth=2,a.strokeRect(1+(r.x<<1),1+(r.y<<1),(r.width<<1)-2,(r.height<<1)-2),a.globalAlpha=1;else if(2==r.type)a.fillStyle=r.isBad?"#FF0000":"#00FF00",a.globalAlpha=.2,a.fillRect(r.x<<1,r.y<<1,r.width<<1,r.height<<1),a.globalAlpha=1;else if(3==r.type){n=r.x<<1,o=r.y<<1;var i=r.width<<1,l=r.height<<1;a.fillStyle=r.color,a.globalAlpha=.2,a.fillRect(n,o,i,l),a.globalAlpha=.5,a.fillStyle="#000000",40>r.width||40>r.height?(a.font="30px NovaSquare",a.fillText(r.count,n+i/2-a.measureText(r.count).width/2,o+l/2+10)):(a.font="60px NovaSquare",a.fillText(r.count,n+i/2-a.measureText(r.count).width/2,o+l/2+20)),a.globalAlpha=1}else if(4==r.type){n=r.x<<1,o=r.y<<1,i=r.width<<1,l=r.height<<1,a.fillStyle=r.color,a.strokeStyle=r.color,a.globalAlpha=1,a.fillRect(n,o,i,l),a.globalAlpha=.2,a.fillStyle="#000000",a.fillRect(n,o,i,l),a.globalAlpha=1,a.fillStyle=r.color;var s=150>t-r.lastClickAt,c=s?8:12;a.fillRect(n+c,o+c,i-2*c,l-2*c),a.strokeStyle="#000000",a.globalAlpha=.1,a.beginPath(),a.moveTo(n,o),a.lineTo(n+c,o+c),a.moveTo(n+i,o),a.lineTo(n+i-c,o+c),a.moveTo(n,o+l),a.lineTo(n+c,o+l-c),a.moveTo(n+i,o+l),a.lineTo(n+i-c,o+l-c),a.moveTo(n,o),a.rect(n,o,i,l),a.rect(n+c,o+c,i-2*c,l-2*c),a.stroke(),a.fillStyle="#000000",a.globalAlpha=.5,50>r.width||50>r.height?(a.font="35px NovaSquare",a.fillText(r.count,n+i/2-a.measureText(r.count).width/2,o+l/2+13)):(a.font="45px NovaSquare",a.fillText(r.count,n+i/2-a.measureText(r.count).width/2,o+l/2+16)),s&&(a.fillStyle="#000000",a.globalAlpha=.15,a.fillRect(n+c,o+c,i-2*c,l-2*c)),a.globalAlpha=1}}if(a.restore(),y||(a.font="12px NovaSquare",a.strokeStyle="#000000",a.fillStyle="#FFFFFF",a.lineWidth=2.5,e=ia?"Area too full, not all cursors are shown":30<ha?"Area too full, drawing is disabled":"Use shift+click to draw",a.globalAlpha=.5,a.strokeText(e,10,590),a.globalAlpha=1,a.fillText(e,10,590),0!=$&&(e=$+" players online",r=a.measureText(e).width,a.globalAlpha=.5,a.strokeText(e,790-r,590),a.globalAlpha=1,a.fillText(e,790-r,590))),e="mouse: X: "+cursorx+" Y: "+cursory+" server: X: "+serverx+" Y: "+servery,a.font="12px NovaSquare",a.strokeStyle="#000000",a.fillStyle="#FFFFFF",a.lineWidth=2.5,a.globalAlpha=.5,a.strokeText(e,690-a.measureText(e).width,574),a.globalAlpha=1,a.fillText(e,690-a.measureText(e).width,574),ma(),!C.checked){for(a.save(),a.strokeStyle="#000000",a.lineWidth=1,t=+new Date,e=0;e<L.length;e++)r=L[e],0>=(n=10-(t-r[4])/1e3)?(L.splice(e,1),--e):(1<n&&(n=1),a.globalAlpha=.3*n,a.beginPath(),a.moveTo(r[0]-.5,r[1]-.5),a.lineTo(r[2]-.5,r[3]-.5),a.stroke());a.restore()}for(var h in a.save(),v)a.fillStyle="#FFFFFF",a.strokeStyle="#000000",a.lineWidth=2.5,a.font="14px NovaSquare",a.globalAlpha=.5,a.strokeText(h.toString(),ra(v[h].getX()),ra(v[h].getY())),a.globalAlpha=1,a.fillText(h.toString(),ra(v[h].getX()),ra(v[h].getY())),v.hasOwnProperty(h)&&a.drawImage(M,ra(v[h].getX())-6,ra(v[h].getY())-6,23,30);a.restore(),na(!0)}a.restore(),window.requestAnimationFrame(la)}function ma(){a.save(),a.strokeStyle="#000000",t=+new Date;for(var e=0;e<D.length;e++){var r=D[e],n=(t-r[2])/1e3,o=1-2*n;0>=o?(D.splice(e,1),--e):(n*=50,a.beginPath(),a.globalAlpha=.3*o,a.arc(r[0],r[1],n,0,2*Math.PI,!1),a.stroke())}a.restore()}function na(e){if(y)a.save(),a.globalAlpha=1,a.drawImage(M,A-5,B-5);else{var t=0,r=0;p!=k||s!=l?(a.save(),e&&(a.globalAlpha=.2,a.fillStyle="#00ff00",a.beginPath(),a.arc(A+2,B+8,20,0,2*Math.PI,!1),a.fill()),a.globalAlpha=.5,a.drawImage(M,A-5,B-5,23,30),a.restore()):(t=1&A,r=1&B),a.save(),e&&(a.globalAlpha=.2,a.fillStyle="#3366ff",a.beginPath(),a.arc((k<<1)+t+2,(l<<1)+r+8,20,0,2*Math.PI,!1),a.fill()),a.globalAlpha=1,a.drawImage(Ha,(k<<1)+t-5,(l<<1)+r-5,23,30)}a.restore()}function ja(e,a){posX=this.oldX=this.newX=e,posY=this.oldY=this.newY=a,this.time=t}function oa(e){return e*e*(3-2*e)}function ea(e,t,a,r){if(a|=0,r|=0,P(e|=0,t|=0))return{x:e,y:t};if(e==a&&t==r)return{x:a,y:r};var n=e,o=t,i=0,l=0,s=0,c=0;0>(a=a-e|0)?i=-1:0<a&&(i=1),0>(r=r-t|0)?l=-1:0<r&&(l=1),0>a?s=-1:0<a&&(s=1);var h=0|Math.abs(a),d=0|Math.abs(r);for(h<=d&&(h=0|Math.abs(r),d=0|Math.abs(a),0>r?c=-1:0<r&&(c=1),s=0),a=h>>1,r=0;r<=h&&!P(e,t);r++)n=e,o=t,(a+=d)>=h?(a-=h,e+=i,t+=l):(e+=s,t+=c);return{x:n,y:o}}function fa(e,t,a,r){return(e=ea(e,t,a,r)).x==a&&e.y==r}function P(e,t){return 0>e||400<=e||0>t||300<=t||Q[e+400*t]}var E,a,x,Aa="file:"==window.location.protocol,ha=0,p=0,s=0,A=0,B=0,k=0,l=0,F=-1,G=-1,I=null,C=null,M=new Image;M.src="img/cursor.png";var Ha=M,y=!1,D=[],L=[],t=0,ba=0,q=null,ga=-1,v={},$=0,ia=!1,W=!1,N=0,O=0,da=0,V=!1,H=!y&&!0,Q=new Uint8Array(12e4),m=[],K=[],R=window.devicePixelRatio;Array.prototype.remove=function(e){return-1!=(e=this.indexOf(e))&&(this.splice(e,1),!0)};var u=0;ja.prototype={oldX:0,oldY:0,newX:0,newY:0,time:0,getX:function(){var e=this.newX-this.oldX,a=oa(0>=(a=(t-this.time)/100)?0:1<=a?1:a);return this.oldX+a*e},getY:function(){var e=this.newY-this.oldY,a=oa(0>=(a=(t-this.time)/100)?0:1<=a?1:a);return this.oldY+a*e}};var pa=function(){function e(){var e=0,t=0,a=s/10;if(c<(n=p/10)?(n=Math.ceil(n),e=Math.floor(c)):(n=Math.floor(n),e=Math.ceil(c)),h<a?(a=Math.ceil(a),t=Math.floor(h)):(a=Math.floor(a),t=Math.ceil(h)),e>n){var r=n,n=e;e=r}return t>a&&(r=a,a=t,t=r),{sx:e,sy:t,fx:n,fy:a}}function t(){i=!0,c=p/10,h=s/10}function r(e){return"0x"+parseInt(e.slice(1),16).toString(16).toUpperCase()}function n(e,t,a,r,n){for(var o in e={x:10*~~(k/10)-~~(e/2)+a,y:10*~~(l/10)-~~(t/2)+r,width:e,height:t},n)n.hasOwnProperty(o)&&(e[o]=n[o]);return e}function o(e,t){for(var a=null,r=Number.POSITIVE_INFINITY,n=0;n<m.length;n++){var o=m[n];if(o.hasOwnProperty("x")&&o.hasOwnProperty("y")&&o.hasOwnProperty("width")&&o.hasOwnProperty("height")){var i=o.x+o.width/2,l=o.y+o.height/2;(i=(e-i)*(e-i)+(t-l)*(t-l))<r&&(r=i,a=o)}}return a}var i=!1,c=0,h=0,d=1,u=200,f=150,g=new Uint8Array(1200),v="#000000 #FF9999 #9999FF #FFFF99 #99FFFF #FF99FF #3333FF".split(" ");return document.addEventListener("mouseup",function(){if(i){for(var t=e(),a=d,r=t.sy;r<t.fy;++r)for(var n=t.sx;n<t.fx;++n)g[n+40*r]=a;i=!1}}),document.addEventListener("mousemove",function(){}),window.generateCode=function(){for(var e=(e="class Level? : public Level {\npublic:\n\tLevel?() : Level("+u+", "+f+"){}\n\n\tvoid OnInit(){\n")+"\t\tstd::vector<LevelObject*> wallByColor["+v.length+"];\n",t=new Uint8Array(1200),a=[],n=0;30>n;++n)for(var o=0;40>o;++o)if(!t[o+40*n]){var i=g[o+40*n];if(0!=i){for(var l=o;40>o&&g[o+40*n]==i&&!t[o+40*n];)t[o+40*n]=!0,++o;var s=o--,c=s-l,h=n++;e:for(;30>n;){for(var d=l;d<s;++d){if(g[d+40*n]!=i)break e;if(t[d+40*n])break e}for(d=l;d<s;++d)t[d+40*n]=!0;++n}s=n-h,n=h,a.push({x:10*l,y:10*h,width:10*c,height:10*s,color:i-1})}}for(t=0;t<a.length;t++)0==(n=a[t]).color?e+="\t\tAddObject(new ObjWall("+n.x+", "+n.y+", "+n.width+", "+n.height+", 0x000000));\n":(o=r(v[n.color]),e+="\t\twallByColor["+n.color+"].push_back(AddObject(new ObjWall("+n.x+", "+n.y+", "+n.width+", "+n.height+", "+o+")));\n");for(t=0;t<m.length;t++)0!=(a=m[t]).type&&(2==a.type?e+="\t\tAddObject(new ObjTeleport(LevelManager::GetNextLevel(this), "+a.x+", "+a.y+", "+a.width+", "+a.height+"));\n":3==a.type?(e+="\t\tAddObject(new ObjAreaCounter(wallByColor["+a.colorCode+"], "+a.x+", "+a.y+", "+a.width+", "+a.height+", ",e+=a.count+", "+r(a.color)+"));\n"):4==a.type&&(e+="\t\tAddObject(new ObjClickBox(wallByColor["+a.colorCode+"], "+a.x+", "+a.y+", "+a.width+", "+a.height+", ",e+=a.count+", 1000, "+r(a.color)+"));\n"));return e+"\t}\n};\n"},document.addEventListener("keydown",function(e){if(y){var t=e.keyCode;65==t?0>--d&&(d=v.length):83==t?++d>v.length&&(d=0):66==t?1>=d||m.push(n(40,40,5,5,{type:4,color:v[d-1],colorCode:d-1,count:5})):90==t?m.pop():87==t?m.push(n(50,50,-5,-5,{type:2,isBad:!1})):79==t?(u=k,f=l):78==t?1>=d||m.push(n(40,40,0,0,{type:3,color:v[d-1],colorCode:d-1,count:1})):37==t?null!=(t=o(p,s))&&(e.shiftKey?t.width-=10:(t.x-=10,t.width+=10),0==t.width&&m.splice(m.indexOf(t),1)):39==t?null!=(t=o(p,s))&&(e.shiftKey?(t.x+=10,t.width-=10):t.width+=10,0==t.width&&m.splice(m.indexOf(t),1)):38==t?null!=(t=o(p,s))&&(e.shiftKey?t.height-=10:(t.y-=10,t.height+=10),0==t.height&&m.splice(m.indexOf(t),1)):40==t&&(null!=(t=o(p,s))&&(e.shiftKey?(t.y+=10,t.height-=10):t.height+=10,0==t.height&&m.splice(m.indexOf(t),1)))}}),{renderEditor:function(){if(y){a.save(),a.fillStyle="#FF0000",a.strokeStyle="#FF0000",a.lineWidth=1,a.globalAlpha=.09,a.beginPath();for(var t=0;400>t;t+=10)a.moveTo(.5+(t<<1),0),a.lineTo(.5+(t<<1),600);for(var r=0;300>r;r+=10)a.moveTo(0,.5+(r<<1)),a.lineTo(800,.5+(r<<1));a.stroke(),a.lineWidth=2,a.beginPath(),a.moveTo(400.5,0),a.lineTo(400.5,600),a.moveTo(0,300.5,0),a.lineTo(800,300.5),a.stroke(),a.lineWidth=1,a.globalAlpha=1,a.fillStyle="#000000";var n=e();for(r=0;300>r;r+=10)for(t=0;400>t;t+=10){var o=t/10|0,l=r/10|0,s=g[o+40*l];i&&o>=n.sx&&o<n.fx&&l>=n.sy&&l<n.fy&&(s=d),0!=s&&(a.fillStyle=v[s-1],a.fillRect(t<<1,r<<1,20,20))}a.save(),a.globalAlpha=.09,a.fillStyle="#0000FF",a.beginPath(),a.arc(u<<1,f<<1,20,0,2*Math.PI,!1),a.fill(),a.restore(),a.save(),a.fillStyle="#FFFFFF",a.strokeStyle="#000000",a.lineWidth=2.5,a.font="14px NovaSquare",a.globalAlpha=.5,a.strokeText("Current color: ",10,590),a.globalAlpha=1,a.fillText("Current color: ",10,590),0==d?a.fillText("ESR",105,590):(a.fillStyle="#000000",a.fillRect(104,575,22,22),a.fillStyle=v[d-1],a.fillRect(105,576,20,20)),a.restore(),a.restore()}},initEditor:function(){x.addEventListener("mousedown",t)}}}(),Ga=pa.renderEditor,Ia=pa.initEditor,Ca=new Uint8Array(12e4);Array.prototype.remove=function(e){return-1!=(e=this.indexOf(e))&&(this.splice(e,1),!0)},setTimeout(function(){E=document.getElementById("canvas"),window.addEventListener("keydown",function(e){if(document.getElementById("message")===document.activeElement||document.getElementById("fontOfMessage")===document.activeElement){if(1===e.key.length)return;if("Enter"===e.key&&document.getElementById("message")===document.activeElement){var t=document.getElementById("message").value,a=document.getElementById("fontOfMessage").value;drawWord(t,serverx,servery,a)}}var r=keybinds[e.code.toLowerCase()];r&&r.action()}),a=E.getContext("2d"),x=document.getElementById("canvasContainer")||E,E.width=800*R,E.height=600*R,a.scale(R,R),x.onmousemove=T,x.onmousedown=ta,x.onmouseup=va,I=document.getElementById("noCursorLock"),C=document.getElementById("noDrawings"),null!=localStorage&&(I.checked="1"==window.localStorage.getItem("noCursorLock"),C.checked="1"==window.localStorage.getItem("noDrawings")),window.onbeforeunload=Ba,x.requestPointerLock=x.requestPointerLock||x.mozRequestPointerLock||x.webkitRequestPointerLock,E.style.cursor="none",Ia(),y||socketConnect(),moveInterval=setInterval(J,50),window.requestAnimationFrame(la)},2e3);
